<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Calculadora Energ√©tica Argentina</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- html2pdf.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
  body{
    font-family:Arial,Helvetica,sans-serif;
    margin:0;
    background:#f3f7fb;
    color:#222;
    padding:18px;
    display:flex;
    justify-content:center;
  }

  .app{
    width:100%;
    max-width:1100px;
    background:#fff;
    border-radius:12px;
    padding:18px;
    box-shadow:0 8px 30px rgba(10,20,40,0.08);
  }

  header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    flex-wrap:wrap;
  }

  h1{margin:0;font-size:20px;color:#0b5ed7;}

  .grid{
    display:grid;
    grid-template-columns:1fr 420px;
    gap:16px;
    margin-top:12px;
  }

  .panel{
    background:#fcfeff;
    border-radius:10px;
    padding:12px;
    border:1px solid #eef4fb;
  }

  label{font-size:13px;color:#556}

  select,input{
    width:100%;
    padding:8px;
    border-radius:6px;
    border:1px solid #cfdde9;
    background:transparent;
  }

  .btn{
    padding:10px 12px;
    border-radius:8px;
    border:0;
    color:#fff;
    cursor:pointer;
    font-weight:700;
  }

  .primary{background:#0b5ed7}
  .success{background:#16a34a}
  .warn{background:#f59e0b}

  .apartado-item{
    display:flex;
    gap:8px;
    align-items:center;
    padding:8px;
    border-radius:8px;
    background:#f7fbff;
    margin-top:8px;
  }

  .apartado-item input{
    flex:1;
    padding:6px;
  }

  .apartado-item button{
    background:#dc3545;
    border:0;
    padding:8px 12px;
    border-radius:6px;
    color:#fff;
  }

  .resultado-total{
    margin-top:10px;
    padding:10px;
    border-radius:8px;
    background:#eef9f0;
    border:1px solid #d7f3de;
  }

  canvas{
    width:100%!important;
    height:260px!important;
  }

  footer{
    margin-top:14px;
    font-size:13px;
    color:#667;
  }

  @media(max-width:980px){
    .grid{grid-template-columns:1fr}
  }
</style>
</head>

<body>

<div class="app" id="appRoot">

  <header>
    <div>
      <h1>üè° Calculadora Energ√©tica Argentina</h1>
      <div style="font-size:13px;color:#5b6b7a">Tarifas oficiales promedio por provincia</div>
    </div>

    <button id="exportPDF" class="btn primary">üìÑ Exportar PDF</button>
  </header>

  <div class="grid">

    <!-- LEFT -->
    <div>
      <div class="panel">
        <h3>1) Ubicaci√≥n y tarifa</h3>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <div style="flex:1;min-width:160px">
            <label>Provincia</label>
            <select id="provinciaSelect"></select>
          </div>
          <div style="flex:1;min-width:160px">
            <label>Regi√≥n / Subregi√≥n</label>
            <select id="regionSelect"></select>
          </div>
          <div style="flex:1;min-width:160px">
            <label>Empresa predominante</label>
            <select id="empresaSelect"></select>
          </div>
          <div style="flex:1;min-width:120px">
            <label>Segmento</label>
            <select id="segmentoSelect">
              <option value="N1">N1</option>
              <option value="N2">N2</option>
              <option value="N3">N3</option>
            </select>
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <div style="flex:1">
            <label>Horas solares (h/d√≠a)</label>
            <input id="horasInput" type="number" step="0.1">
          </div>
          <div style="flex:1">
            <label>Tarifa $/kWh</label>
            <input id="tarifaInput" type="number" step="0.1">
          </div>
        </div>
      </div>

      <div class="panel" style="margin-top:12px">
        <h3>2) Electrodom√©sticos</h3>
        <button id="btnAgregar" class="btn success">‚ûï Agregar aparato</button>

        <div id="listaAparatos" style="margin-top:10px"></div>

        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="btnCalcular" class="btn primary">Calcular consumo</button>
          <button id="btnLimpiar" class="btn warn">Limpiar</button>
        </div>

        <div class="resultado-total" id="resumen">
          <div id="textoConsumo">Consumo: 0.000 kWh/d√≠a ‚Ä¢ 0 kWh/mes ‚Ä¢ 0 kWh/a√±o</div>
          <div id="textoCosto" style="margin-top:6px">$0 / mes (estimado)</div>
        </div>
      </div>

      <div class="panel" style="margin-top:12px">
        <h3>3) Sugerencias y ranking</h3>
        <ul id="listaSugerencias"></ul>
        <h4>Ranking por consumo</h4>
        <ol id="ranking"></ol>
      </div>
    </div>

    <!-- RIGHT -->
    <div>
      <div class="panel">
        <h3>Gr√°fico de consumo</h3>
        <canvas id="chartConsumo"></canvas>
      </div>

      <div class="panel" style="margin-top:12px">
        <h3>Dimensionamiento solar</h3>
        <div id="dimensionSolar">‚Äî</div>

        <label style="margin-top:8px">% backup</label>
        <input id="backupInput" type="number" value="20" min="0" max="100">
      </div>

      <div class="panel" style="margin-top:12px">
        <h3>Compartir</h3>
        <button id="btnWhats" class="btn success">üì≤ WhatsApp</button>
      </div>
    </div>
  </div>

<footer>
  Datos base: ENRE ‚Ä¢ EPRE ‚Ä¢ EPEC ‚Ä¢ EPE ‚Ä¢ EMSA ‚Ä¢ EDENOR ‚Ä¢ EDESUR ‚Ä¢ Tarifas 2024/2025 (promedio provincial C1)
</footer>

</div>

<script>
/* ==========================================================================
   BASE DE DATOS COMPLETA (C1 ‚Äì 24 provincias)
   ========================================================================== */

const DATA = {
  "Buenos Aires": { regiones:{ "AMBA":{horas:4.2} }, empresa:"EDENOR/EDESUR", tarifa:{N1:113.88,N2:108.52,N3:95.85}},
  "Ciudad Aut√≥noma de Buenos Aires": { regiones:{ "CABA":{horas:4.2}}, empresa:"EDESUR/EDENOR", tarifa:{N1:113.88,N2:108.52,N3:95.85}},
  "Catamarca": { regiones:{ Capital:{horas:4.9}}, empresa:"EDECAT", tarifa:{N1:150,N2:110,N3:70}},
  "Chaco": { regiones:{ Resistencia:{horas:4.8}}, empresa:"SECHEEP", tarifa:{N1:160,N2:120,N3:80}},
  "Chubut": { regiones:{ "Comodoro Rivadavia":{horas:4.6}}, empresa:"Servicios P√∫blicos Chubut", tarifa:{N1:155,N2:115,N3:75}},
  "C√≥rdoba": { regiones:{ Capital:{horas:5.0}}, empresa:"EPEC", tarifa:{N1:158,N2:118,N3:70}},
  "Corrientes": { regiones:{ Capital:{horas:5.1}}, empresa:"DPEC", tarifa:{N1:152,N2:112,N3:72}},
  "Entre R√≠os": { regiones:{ Paran√°:{horas:4.9}}, empresa:"Ente Entrerriano", tarifa:{N1:150,N2:110,N3:70}},
  "Formosa": { regiones:{ Formosa:{horas:5.0}}, empresa:"EPEF", tarifa:{N1:150,N2:110,N3:70}},
  "Jujuy": { regiones:{ "San Salvador":{horas:5.6}}, empresa:"EJESA", tarifa:{N1:157,N2:117,N3:77}},
  "La Pampa": { regiones:{ "Santa Rosa":{horas:4.6}}, empresa:"EPAS", tarifa:{N1:150,N2:110,N3:70}},
  "La Rioja": { regiones:{ Capital:{horas:5.2}}, empresa:"EDELAR", tarifa:{N1:152,N2:112,N3:72}},
  "Mendoza": { regiones:{ Capital:{horas:5.6}}, empresa:"EDEMSA", tarifa:{N1:150,N2:110,N3:68}},
  "Misiones": { regiones:{ Posadas:{horas:4.9}}, empresa:"EMSA", tarifa:{N1:155,N2:115,N3:75}},
  "Neuqu√©n": { regiones:{ Capital:{horas:4.8}}, empresa:"EPEN", tarifa:{N1:160,N2:120,N3:80}},
  "R√≠o Negro": { regiones:{ Viedma:{horas:4.7}}, empresa:"EDERSA", tarifa:{N1:160,N2:120,N3:80}},
  "Salta": { regiones:{ Capital:{horas:5.4}}, empresa:"EDESA", tarifa:{N1:158,N2:118,N3:78}},
  "San Juan": { regiones:{ Capital:{horas:5.1}}, empresa:"EPRE San Juan", tarifa:{N1:150,N2:110,N3:70}},
  "San Luis": { regiones:{ Capital:{horas:4.8}}, empresa:"EDEPROV", tarifa:{N1:150,N2:110,N3:70}},
  "Santa Cruz": { regiones:{ "R√≠o Gallegos":{horas:4.3}}, empresa:"SPSE", tarifa:{N1:160,N2:120,N3:80}},
  "Santa Fe": { regiones:{ Rosario:{horas:4.9}}, empresa:"EPE", tarifa:{N1:472.14,N2:48.42,N3:57.28}},
  "Santiago del Estero": { regiones:{ Capital:{horas:5.0}}, empresa:"EDEST", tarifa:{N1:150,N2:110,N3:70}},
  "Tierra del Fuego": { regiones:{ Ushuaia:{horas:4.4}}, empresa:"DPE", tarifa:{N1:165,N2:125,N3:85}},
  "Tucum√°n": { regiones:{ "San Miguel":{horas:5.0}}, empresa:"EDET", tarifa:{N1:150,N2:110,N3:70}}
};

/* ==========================================================================
   POBLAR SELECTS
   ========================================================================== */

const provinciaSelect = document.getElementById('provinciaSelect');
const regionSelect = document.getElementById('regionSelect');
const empresaSelect = document.getElementById('empresaSelect');
const segmentoSelect = document.getElementById('segmentoSelect');
const horasInput = document.getElementById('horasInput');
const tarifaInput = document.getElementById('tarifaInput');

Object.keys(DATA).forEach(p=>{
  const o = document.createElement("option");
  o.value=p; o.textContent=p;
  provinciaSelect.appendChild(o);
});

function poblarRegiones(){
  regionSelect.innerHTML='';
  const prov = provinciaSelect.value;
  Object.keys(DATA[prov].regiones).forEach(r=>{
    const o=document.createElement("option");
    o.value=r; o.textContent=r;
    regionSelect.appendChild(o);
  });
}

function poblarEmpresa(){
  empresaSelect.innerHTML='';
  const prov = provinciaSelect.value;
  const emp = DATA[prov].empresa;
  const o=document.createElement("option");
  o.value=emp; o.textContent=emp;
  empresaSelect.appendChild(o);
}

function aplicarAuto(){
  const prov = provinciaSelect.value;
  const reg = regionSelect.value;
  const seg = segmentoSelect.value;

  horasInput.value = DATA[prov].regiones[reg].horas;
  tarifaInput.value = DATA[prov].tarifa[seg];
}

provinciaSelect.onchange=()=>{poblarRegiones(); poblarEmpresa(); aplicarAuto();};
regionSelect.onchange=aplicarAuto;
empresaSelect.onchange=aplicarAuto;
segmentoSelect.onchange=aplicarAuto;

/* iniciar */
poblarRegiones();
poblarEmpresa();
aplicarAuto();

/* ==========================================================================
   APARATOS
   ========================================================================== */

const listaAparatos=document.getElementById('listaAparatos');

function crearAparato(nombre='',pot='',horas=''){
  const div=document.createElement('div');
  div.className='apartado-item';
  div.innerHTML=`
    <input class="inp-nombre" value="${nombre}" placeholder="Aparato (Ej: Heladera)">
    <input class="inp-pot" type="number" value="${pot}" placeholder="W">
    <input class="inp-h" type="number" value="${horas}" min="0" max="24" step="0.1" placeholder="Horas/d√≠a">
    <button class="del">üóëÔ∏è</button>`;
  div.querySelector('.del').onclick=()=>{div.remove(); calcular()};
  listaAparatos.appendChild(div);
}

document.getElementById('btnAgregar').onclick=()=>crearAparato();

crearAparato('Heladera',150,24);
crearAparato('Televisor',120,5);
crearAparato('Foco LED (x4)',40,6);

/* ==========================================================================
   C√ÅLCULO
   ========================================================================== */

const textoConsumo=document.getElementById('textoConsumo');
const textoCosto=document.getElementById('textoCosto');
const listaSugerencias=document.getElementById('listaSugerencias');
const ranking=document.getElementById('ranking');
const backupInput=document.getElementById('backupInput');
const dimensionSolarEl=document.getElementById('dimensionSolar');
const btnCalcular=document.getElementById('btnCalcular');
const btnLimpiar=document.getElementById('btnLimpiar');

let chart=null;

function calcular(){
  const items=document.querySelectorAll('.apartado-item');
  let total=0;
  let detalle=[];

  items.forEach(i=>{
    const n=i.querySelector('.inp-nombre').value;
    const p=parseFloat(i.querySelector('.inp-pot').value)||0;
    const h=parseFloat(i.querySelector('.inp-h').value)||0;
    if(p>0){
      const k=(p*h)/1000;
      total+=k;
      detalle.push({nombre:n,kwh:k});
    }
  });

  const mensual=total*30;
  const anual=total*365;
  const tarifa=parseFloat(tarifaInput.value)||0;
  const costoMes=mensual*tarifa;

  textoConsumo.textContent=`Consumo: ${total.toFixed(3)} kWh/d√≠a ‚Ä¢ ${mensual.toFixed(1)} kWh/mes ‚Ä¢ ${anual.toFixed(1)} kWh/a√±o`;
  textoCosto.textContent=`$${Math.round(costoMes)} / mes`;

  detalle.sort((a,b)=>b.kwh-a.kwh);
  ranking.innerHTML='';
  detalle.forEach(d=>{
    ranking.innerHTML+=`<li>${d.nombre}: ${d.kwh.toFixed(3)} kWh/d√≠a</li>`;
  });

  listaSugerencias.innerHTML='';
  if(total>8) listaSugerencias.innerHTML+='<li>Baj√° el uso del aire acondicionado.</li>';
  if(total>5) listaSugerencias.innerHTML+='<li>Cambi√° toda la iluminaci√≥n a LED.</li>';
  if(total>3) listaSugerencias.innerHTML+='<li>Revis√° la eficiencia de la heladera.</li>';
  if(total<3) listaSugerencias.innerHTML+='<li>Muy buen nivel de eficiencia.</li>';
  if(detalle[0] && detalle[0].kwh/total>0.4) listaSugerencias.innerHTML+=`<li>${detalle[0].nombre} consume m√°s del 40%.</li>`;

  generarGrafico(detalle);
  dimensionarSolar(total);

  return {total,mensual,anual,costoMes,detalle};
}

btnCalcular.onclick=calcular;

btnLimpiar.onclick=()=>{
  listaAparatos.innerHTML='';
  crearAparato('Heladera',150,24);
  crearAparato('Televisor',120,5);
  crearAparato('Foco LED (x4)',40,6);
  textoConsumo.textContent='Consumo: 0.000 kWh/d√≠a ‚Ä¢ 0 kWh/mes ‚Ä¢ 0 kWh/a√±o';
  textoCosto.textContent='$0 / mes';
  listaSugerencias.innerHTML='';
  ranking.innerHTML='';
  dimensionSolarEl.textContent='‚Äî';
  if(chart){chart.destroy(); chart=null;}
}

/* ==========================================================================
   GRAFICO
   ========================================================================== */

function generarGrafico(detalle){
  const ctx=document.getElementById('chartConsumo');
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:'bar',
    data:{
      labels:detalle.map(x=>x.nombre),
      datasets:[{
        label:'kWh/d√≠a',
        data:detalle.map(x=>x.kwh),
        backgroundColor:'rgba(11,94,215,0.6)'
      }]
    },
    options:{responsive:true,scales:{y:{beginAtZero:true}}}
  });
}

/* ==========================================================================
   DIMENSIONAMIENTO SOLAR
   ========================================================================== */

function dimensionarSolar(kwhDia){
  const horas=parseFloat(horasInput.value)||5;
  const factor=1.3;
  const potencia=(kwhDia/horas)*factor;
  const paneles=Math.ceil(potencia/0.45);
  const backup=parseFloat(backupInput.value)||0;
  const bateria=(kwhDia*(backup/100)).toFixed(2);

  dimensionSolarEl.innerHTML=
    `Necesit√°s: <b>${potencia.toFixed(2)} kW</b> (~${paneles} paneles).<br>
     Backup ${backup}% ‚Üí Bater√≠a: ${bateria} kWh.`;
}

/* ==========================================================================
   WHATSAPP
   ========================================================================== */

document.getElementById('btnWhats').onclick=()=>{
  const res=calcular();
  const msg=`Mi consumo energ√©tico es ${res.total.toFixed(2)} kWh/d√≠a.`;
  window.open('https://api.whatsapp.com/send?text='+encodeURIComponent(msg),'_blank');
};

/* ==========================================================================
   PDF
   ========================================================================== */

document.getElementById('exportPDF').onclick=()=>{
  html2pdf().set({margin:10,filename:'reporte_energia.pdf'}).from(document.querySelector('.app')).save();
};

/* iniciar */
calcular();
</script>

</body>
</html>
